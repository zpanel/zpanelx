window.rcmail&&rcmail.addEventListener("init",function(a){if("settings"==rcmail.env.task){rcmail.register_command("plugin.enigma",function(){rcmail.goto_url("plugin.enigma")},!0);rcmail.register_command("plugin.enigma-key-import",function(){rcmail.enigma_key_import()},!0);rcmail.register_command("plugin.enigma-key-export",function(){rcmail.enigma_key_export()},!0);if(rcmail.gui_objects.keyslist){var b=rcmail;rcmail.keys_list=new rcube_list_widget(rcmail.gui_objects.keyslist,{multiselect:!1,draggable:!1,
keyboard:!1});rcmail.keys_list.addEventListener("select",function(a){b.enigma_key_select(a)});rcmail.keys_list.init();rcmail.keys_list.focus();rcmail.enigma_list();rcmail.register_command("firstpage",function(a){return rcmail.enigma_list_page("first")});rcmail.register_command("previouspage",function(a){return rcmail.enigma_list_page("previous")});rcmail.register_command("nextpage",function(a){return rcmail.enigma_list_page("next")});rcmail.register_command("lastpage",function(a){return rcmail.enigma_list_page("last")})}"edit-prefs"==
rcmail.env.action?(rcmail.register_command("search",function(a){return rcmail.enigma_search(a)},!0),rcmail.register_command("reset-search",function(a){return rcmail.enigma_search_reset(a)},!0)):"plugin.enigma"==rcmail.env.action&&(rcmail.register_command("plugin.enigma-import",function(){rcmail.enigma_import()},!0),rcmail.register_command("plugin.enigma-export",function(){rcmail.enigma_export()},!0))}});rcube_webmail.prototype.enigma_key_import=function(){this.enigma_loadframe(null,"&_a=keyimport")};
rcube_webmail.prototype.enigma_import=function(){var a,b;if(a=this.gui_objects.importform)(b=document.getElementById("rcmimportfile"))&&!b.value?alert(this.get_label("selectimportfile")):(a.submit(),this.set_busy(!0,"importwait"),this.lock_form(a,!0))};rcube_webmail.prototype.enigma_key_select=function(a){var b;(b=a.get_single_selection())&&this.enigma_loadframe(b)};
rcube_webmail.prototype.enigma_loadframe=function(a,b){var d,c;this.env.contentframe&&window.frames&&(d=window.frames[this.env.contentframe])&&(a||b||!(c=window.frames[this.env.contentframe])?(this.set_busy(!0),b||(b="&_a=keyinfo&_id="+a),d.location.href=this.env.comm_path+"&_action=plugin.enigma&_framed=1"+b):c.location&&0>c.location.href.indexOf(this.env.blankpage)&&(c.location.href=this.env.blankpage))};
rcube_webmail.prototype.enigma_search=function(a){!a&&this.gui_objects.qsearchbox&&(a=this.gui_objects.qsearchbox.value);if(a||this.env.search_request){a={_a:"keysearch",_q:urlencode(a)};var b=this.set_busy(!0,"searching");this.env.current_page=1;this.enigma_loadframe();this.enigma_clear_list();this.http_post("plugin.enigma",a,b)}return!1};
rcube_webmail.prototype.enigma_search_reset=function(a){a=this.env.search_request;this.reset_qsearch();a&&(this.enigma_loadframe(),this.enigma_clear_list(),this.enigma_list());return!1};rcube_webmail.prototype.enigma_list=function(a){var b={_a:"keylist"},d=this.set_busy(!0,"loading");this.env.current_page=a?a:1;this.env.search_request&&(b._q=this.env.search_request);a&&(b._p=a);this.enigma_clear_list();this.http_post("plugin.enigma",b,d)};
rcube_webmail.prototype.enigma_list_page=function(a){"next"==a?a=this.env.current_page+1:"last"==a?a=this.env.pagecount:"prev"==a&&1<this.env.current_page?a=this.env.current_page-1:"first"==a&&1<this.env.current_page&&(a=1);this.enigma_list(a)};rcube_webmail.prototype.enigma_clear_list=function(){this.enigma_loadframe();this.keys_list&&this.keys_list.clear(!0)};
rcube_webmail.prototype.enigma_add_list_row=function(a){if(!this.gui_objects.keyslist||!this.keys_list)return!1;var b=this.keys_list,d="message"+(this.gui_objects.keyslist.tBodies[0].rows.length%2?" even":" odd"),c=document.createElement("tr"),e=document.createElement("td");c.id="rcmrow"+a.id;c.className=d;e.innerHTML=a.name;c.appendChild(e);b.insert_row(c)};
rcube_webmail.prototype.enigma_import_attachment=function(a){var b=this.set_busy(!0,"loading");this.http_post("plugin.enigmaimport","_uid="+this.env.uid+"&_mbox="+urlencode(this.env.mailbox)+"&_part="+urlencode(a),b);return!1};
