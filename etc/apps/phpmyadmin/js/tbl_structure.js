AJAX.registerTeardown("tbl_structure.js",function(){$("a.change_column_anchor.ajax").die("click");$("button.change_columns_anchor.ajax, input.change_columns_anchor.ajax").die("click");$("a.drop_column_anchor.ajax").die("click");$("a.add_primary_key_anchor.ajax").die("click");$("#move_columns_anchor").die("click");$(".append_fields_form.ajax").unbind("submit")});AJAX.registerOnload("tbl_structure.js",function(){$(".append_fields_form.ajax").die().live("submit",function(b){b.preventDefault();var a=$(this);if(checkTableEditForm(a[0],a.find("input[name=orig_num_fields]").val())){PMA_prepareForAjaxRequest(a);$msg=PMA_ajaxShowMessage();$.post(a.attr("action"),a.serialize()+"&do_save_data=1",function(c){if($("#sqlqueryresults").length!=0){$("#sqlqueryresults").remove()}else{if($(".error:not(.tab)").length!=0){$(".error:not(.tab)").remove()}}if(c.success==true){$("#page_content").empty().append(c.message).append(c.sql_query).show();$("#result_query .notice").remove();a.remove();PMA_ajaxRemoveMessage($msg);PMA_reloadNavigation()}else{PMA_ajaxShowMessage(c.error,false)}})}});$("a.change_column_anchor.ajax").live("click",function(b){b.preventDefault();var a=PMA_ajaxShowMessage();$("#page_content").hide();$.get($(this).attr("href"),{ajax_request:true},function(c){PMA_ajaxRemoveMessage(a);if(c.success){$('<div id="change_column_dialog" class="margin"></div>').html(c.message).insertBefore("#page_content");PMA_verifyColumnsProperties()}else{PMA_ajaxShowMessage(PMA_messages.strErrorProcessingRequest+" : "+c.error,false)}})});$("button.change_columns_anchor.ajax, input.change_columns_anchor.ajax").live("click",function(c){c.preventDefault();var a=PMA_ajaxShowMessage();$("#page_content").hide();var b=$(this).closest("form");var d=b.serialize()+"&ajax_request=true&submit_mult=change";$.post(b.prop("action"),d,function(e){PMA_ajaxRemoveMessage(a);if(e.success){$("#page_content").empty().append($('<div id="change_column_dialog"></div>').html(e.message)).show();PMA_verifyColumnsProperties()}else{$("#page_content").show();PMA_ajaxShowMessage(e.error)}})});$("a.drop_column_anchor.ajax").live("click",function(c){c.preventDefault();var f=$(this).closest("form").find("input[name=table]").val();var b=$(this).parents("tr");var d=b.children("th").children("label").text();var e=$("select[name='after_field'] option[value='"+d+"']");var a=$.sprintf(PMA_messages.strDoYouReally,"ALTER TABLE `"+escapeHtml(f)+"` DROP `"+escapeHtml(d)+"`;");$(this).PMA_confirm(a,$(this).attr("href"),function(h){var g=PMA_ajaxShowMessage(PMA_messages.strDroppingColumn,false);$.get(h,{is_js_confirmed:1,ajax_request:true,ajax_page_request:true},function(k){if(k.success==true){PMA_ajaxRemoveMessage(g);if($("#result_query").length){$("#result_query").remove()}if(k.sql_query){$('<div id="result_query"></div>').html(k.sql_query).prependTo("#page_content")}toggleRowColors(b.next());for(var j=b.next();j.length>0;j=j.next()){var i=parseInt(j.find("td:nth-child(2)").text())-1;j.find("td:nth-child(2)").text(i)}e.remove();b.hide("medium").remove();if(k.tableStat){$("#tablestatistics").html(k.tableStat)}$(".index_info").replaceWith(k.indexes_list);PMA_reloadNavigation()}else{PMA_ajaxShowMessage(PMA_messages.strErrorProcessingRequest+" : "+k.error,false)}})})});$("a.add_primary_key_anchor.ajax").live("click",function(b){b.preventDefault();var d=$(this).closest("form").find("input[name=table]").val();var c=$(this).parents("tr").children("th").children("label").text();var a=$.sprintf(PMA_messages.strDoYouReally,"ALTER TABLE `"+escapeHtml(d)+"` ADD PRIMARY KEY(`"+escapeHtml(c)+"`);");$(this).PMA_confirm(a,$(this).attr("href"),function(f){var e=PMA_ajaxShowMessage(PMA_messages.strAddingPrimaryKey,false);$.get(f,{is_js_confirmed:1,ajax_request:true},function(g){if(g.success==true){PMA_ajaxRemoveMessage(e);$(this).remove();if(typeof g.reload!="undefined"){PMA_commonActions.refreshMain(false,function(){if($("#result_query").length){$("#result_query").remove()}if(g.sql_query){$('<div id="result_query"></div>').html(g.sql_query).prependTo("#page_content")}});PMA_reloadNavigation()}}else{PMA_ajaxShowMessage(PMA_messages.strErrorProcessingRequest+" : "+g.error,false)}})})});$("#move_columns_anchor").live("click",function(g){g.preventDefault();if($(this).hasClass("move-active")){return}var b={};b[PMA_messages.strGo]=function(i){i.preventDefault();var l=PMA_ajaxShowMessage();var k=$(this);var e=k.find("form");var j=e.serialize();if(j==e.data("serialized-unmoved")){PMA_ajaxRemoveMessage(l);k.dialog("close");return}$.post(e.prop("action"),j+"&ajax_request=true",function(t){if(t.success==false){PMA_ajaxRemoveMessage(l);k.clone().html(t.error).dialog({title:$(this).prop("title"),height:230,width:900,modal:true,buttons:f})}else{$("#fieldsForm ul.table-structure-actions").menuResizer("destroy");var o=$("table#tablestructure tbody");var q=o.find("tr").remove();for(var r in t.columns){var s=t.columns[r];var p=q.find("input:checkbox[value="+s+"]").closest("tr");o.append(p)}var n=o.find("tr").eq(0);for(var m=n;m.length>0;m=m.next()){m.find("td:nth-child(2)").text(m.index()+1).end().removeClass("odd even").addClass(m.index()%2==0?"odd":"even")}PMA_ajaxShowMessage(t.message);k.dialog("close");$("#fieldsForm ul.table-structure-actions").menuResizer(PMA_tbl_structure_menu_resizer_callback)}})};b[PMA_messages.strCancel]=function(){$(this).dialog("close")};var f={};f[PMA_messages.strOK]=function(){$(this).dialog("close").remove()};var d=[];$("#tablestructure tbody tr").each(function(){var i=$(this).find("input:checkbox").eq(0).val();var e=$("<input/>").prop({name:"move_columns[]",type:"hidden"}).val(i);d[d.length]=$("<li/>").addClass("placeholderDrag").text(i).append(e)});var h=$("#move_columns_dialog ul").find("li").remove().end();for(var c in d){h.append(d[c])}h.sortable({axis:"y",containment:$("#move_columns_dialog div")}).disableSelection();var a=$("#move_columns_dialog form");a.data("serialized-unmoved",a.serialize());$("#move_columns_dialog").dialog({modal:true,buttons:b,beforeClose:function(){$("#move_columns_anchor").removeClass("move-active")}})})});function reloadFieldForm(a){$.post($("#fieldsForm").attr("action"),$("#fieldsForm").serialize()+"&ajax_request=true",function(c){var b=$("<div id='temp_div'><div>").append(c.message);$("#fieldsForm").replaceWith(b.find("#fieldsForm"));$("#addColumns").replaceWith(b.find("#addColumns"));$("#move_columns_dialog ul").replaceWith(b.find("#move_columns_dialog ul"));$("#moveColumns").removeClass("move-active");$("#fieldsForm ul.table-structure-actions").menuResizer(PMA_tbl_structure_menu_resizer_callback);setTimeout(function(){PMA_ajaxShowMessage(a)},500)});$("#page_content").show()}function PMA_tbl_structure_menu_resizer_callback(){var c=$("body").width();var b=$("#page_content");c-=b.outerWidth(true)-b.outerWidth();var d=0;var a=$("#tablestructure").find("tr:eq(1)").find("td,th");a.not(":last").each(function(){d+=$(this).outerWidth(true)});var e=$("#tablestructure").width();a.each(function(){e-=$(this).outerWidth(true)});return c-d-e-15}AJAX.registerOnload("tbl_structure.js",function(){if($("#fieldsForm").hasClass("HideStructureActions")){$("#fieldsForm ul.table-structure-actions").menuResizer(PMA_tbl_structure_menu_resizer_callback)}});AJAX.registerTeardown("tbl_structure.js",function(){$("#fieldsForm ul.table-structure-actions").menuResizer("destroy")});$(function(){$(window).resize($.throttle(function(){var a=$("#fieldsForm ul.table-structure-actions");if(a.length){a.menuResizer("resize")}}))});