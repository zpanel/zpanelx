function nullify(f,h,c,g){var d=document.forms.insertForm;if(typeof(d.elements["funcs"+g+"["+c+"]"])!="undefined"){d.elements["funcs"+g+"["+c+"]"].selectedIndex=-1}if(f==1){d.elements["fields"+g+"["+c+"]"][1].selectedIndex=-1}else{if(f==2){var e=d.elements["fields"+g+"["+c+"]"];if(e.checked){e.checked=false}else{var a=e.length;for(var b=0;b<a;b++){e[b].checked=false}}}else{if(f==3){d.elements["fields"+g+"["+c+"][]"].selectedIndex=-1}else{if(f==4){d.elements["fields"+g+"["+c+"]"].selectedIndex=-1}else{if(f==6){d.elements["fields"+g+"["+c+"]"].value=""}else{d.elements["fields"+g+"["+c+"]"].value=""}}}}}return true}function daysInFebruary(a){return(((a%4==0)&&((!(a%100==0))||(a%400==0)))?29:28)}function fractionReplace(a){a=parseInt(a);return a>=1&&a<=9?"0"+a:"00"}function isDate(b,d){b=b.replace(/[.|*|^|+|//|@]/g,"-");var g=b.split("-");for(var j=0;j<g.length;j++){if(g[j].length==1){g[j]=fractionReplace(g[j])}}b=g.join("-");var h=2;var c=new RegExp(/^([0-9]{4})-(((01|03|05|07|08|10|12)-((0[0-9])|([1-2][0-9])|(3[0-1])))|((02|04|06|09|11)-((0[0-9])|([1-2][0-9])|30)))$/);if(b.length==8){h=0}if(c.test(b)){var e=parseInt(b.substring(h+3,h+5));var i=parseInt(b.substring(h+6,h+8));var f=parseInt(b.substring(0,h+2));if(e==2&&i>daysInFebruary(f)){return false}if(b.substring(0,h+2).length==2){f=parseInt("20"+b.substring(0,h+2))}if(d==true){if(f<1978){return false}if(f>2038||(f>2037&&i>19&&e>=1)||(f>2037&&e>1)){return false}}}else{return false}return true}function isTime(f){var d=f.split(":");for(var c=0,b=d.length;c<b;c++){if(d[c].length==1){d[c]=fractionReplace(d[c])}}f=d.join(":");var e=new RegExp(/^(([0-1][0-9])|(2[0-3])):((0[0-9])|([1-5][0-9])):((0[0-9])|([1-5][0-9]))$/);return e.test(f)}function verificationsAfterFieldChange(c,g,b){var h=window.event||arguments.callee.caller.arguments[0];var e=h.target||h.srcElement;$("input[name='fields_null[multi_edit]["+g+"]["+c+"]']").prop("checked",false);$("input[name='insert_ignore_"+g+"']").prop("checked",false);var f=$("input[name='fields[multi_edit]["+g+"]["+c+"]']");if(f.data("comes_from")=="datepicker"){f.removeClass("invalid_value");return true}if(e.name.substring(0,6)=="fields"){if(b=="datetime"||b=="time"||b=="date"||b=="timestamp"){f.removeClass("invalid_value");var i=f.val();if(b=="date"){if(!isDate(i)){f.addClass("invalid_value");return false}}else{if(b=="time"){if(!isTime(i)){f.addClass("invalid_value");return false}}else{if(b=="datetime"||b=="timestamp"){var d=false;if(i=="CURRENT_TIMESTAMP"){return true}if(b=="timestamp"){d=true}if(i=="0000-00-00 00:00:00"){return true}var a=i.indexOf(" ");if(a==-1){f.addClass("invalid_value");return false}else{if(!(isDate(i.substring(0,a),d)&&isTime(i.substring(a+1)))){f.addClass("invalid_value");return false}}}}}}if(b.substring(0,3)=="int"){f.removeClass("invalid_value");if(isNaN(f.val())){f.addClass("invalid_value");return false}}}}AJAX.registerTeardown("tbl_change.js",function(){$("span.open_gis_editor").die("click");$("input[name='gis_data[save]']").die("click");$("input.checkbox_null").unbind("click");$('select[name="submit_type"]').unbind("change");$("#insert_rows").die("change")});AJAX.registerOnload("tbl_change.js",function(){$.datepicker.initialized=false;$("span.open_gis_editor").live("click",function(d){d.preventDefault();var a=$(this);var e=a.parent("td").children("input[type='text']").val();var f=a.parents("tr").children("td:first").find("input[type='hidden']").val();var c=a.parents("tr").find("span.column_type").text();var g=a.parent("td").children("input[type='text']").attr("name");var b=$("input[name='token']").val();openGISEditor();if(!gisEditorLoaded){loadJSAndGISEditor(e,f,c,g,b)}else{loadGISEditor(e,f,c,g,b)}});$("input[name='gis_data[save]']").live("click",function(b){var c=$("form#gis_data_editor_form").find("input[name='input_name']").val();var a=$("input[name='"+c+"']").parents("tr").find(".checkbox_null");a.prop("checked",false)});$("input.checkbox_null").bind("click",function(a){nullify($(this).siblings(".nullify_code").val(),$(this).closest("tr").find("input:hidden").first().val(),$(this).siblings(".hashed_field").val(),$(this).siblings(".multi_edit").val())});$('select[name="submit_type"]').bind("change",function(g){var b=$("table.insertRowTable");var f=b.find('input[name^="auto_increment"]').attr("name");if(f){var d=b.find('input[name="'+f.replace("auto_increment","fields_prev")+'"]');var c=b.find('input[name="'+f.replace("auto_increment","fields")+'"]');var a=$(d).val();if(a!==undefined){if($(this).val()=="insert"||$(this).val()=="insertignore"||$(this).val()=="showinsert"){$(c).val(0)}else{$(c).val(a)}}}});$("#insert_rows").live("change",function(a){a.preventDefault();var f=$("table.insertRowTable").length;var g=$("#insert_rows").val();$("input.datefield, input.datetimefield").each(function(){$(this).datepicker("destroy")});if(f<g){while(f<g){var d=$("#insertForm").find(".insertRowTable:last");var h=0;d.clone().insertBefore("#actions_panel").find("input[name*=multi_edit],select[name*=multi_edit],textarea[name*=multi_edit]").each(function(){var o=$(this);var k=o.attr("name");var n=k.split(/\[\d+\]/);var m=k.match(/\[\d+\]/)[0];var l=parseInt(m.match(/\d+/)[0]);h=l+1;var p=n[0]+"["+h+"]"+n[1];var q=n[1].match(/\[(.+)\]/)[1];o.attr("name",p);if(o.is(".textfield")){if(o.closest("tr").find("span.column_type").html()!="enum"){o.val(o.closest("tr").find("span.default_value").html())}o.unbind("change").attr("onchange",null).data("hashed_field",q).data("new_row_index",h).bind("change",function(s){var r=$(this);verificationsAfterFieldChange(r.data("hashed_field"),r.data("new_row_index"),r.closest("tr").find("span.column_type").html())})}if(o.is(".checkbox_null")){o.unbind("click").data("hashed_field",q).data("new_row_index",h).bind("click",function(s){var r=$(this);nullify(r.siblings(".nullify_code").val(),o.closest("tr").find("input:hidden").first().val(),r.data("hashed_field"),"[multi_edit]["+r.data("new_row_index")+"]")})}}).end().find(".foreign_values_anchor").each(function(){var m=$(this);var k="rownumber="+h;var l=m.attr("href").replace(/rownumber=\d+/,k);m.attr("href",l)});if(f==1){$('<input id="insert_ignore_1" type="checkbox" name="insert_ignore_1" checked="checked" />').insertBefore("table.insertRowTable:last").after('<label for="insert_ignore_1">'+PMA_messages.strIgnore+"</label>")}else{var i=$("#insertForm").children("input:checkbox:last");var j=i.attr("name");var b=parseInt(j.match(/\d+/));var c=j.replace(/\d+/,b+1);i.clone().attr({id:c,name:c}).prop("checked",true).add("label[for^=insert_ignore]:last").clone().attr("for",c).before("<br />").insertBefore("table.insertRowTable:last")}f++}var e=0;$(".textfield").each(function(){e++;$(this).attr("tabindex",e);$(this).attr("id","field_"+e+"_3")});$("select.control_at_footer").each(function(){e++;$(this).attr("tabindex",e)});$("input.datefield, input.datetimefield").each(function(){PMA_addDatepicker($(this))})}else{if(f>g){while(f>g){$("input[id^=insert_ignore]:last").nextUntil("fieldset").andSelf().remove();f--}}}})});