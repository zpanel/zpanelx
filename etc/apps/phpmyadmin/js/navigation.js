$(function(){if(!$("#pma_navigation").length){return}new ResizeHandler();$("#pma_navigation_tree a.expander").live("click",function(b){b.preventDefault();b.stopImmediatePropagation();var h=$(this);var i=h.closest("li").children("div.list_container");var g=h.find("img");if(h.hasClass("loaded")){if(g.is(".ic_b_plus")){g.removeClass("ic_b_plus").addClass("ic_b_minus");i.show("fast")}else{g.removeClass("ic_b_minus").addClass("ic_b_plus");i.hide("fast")}}else{var f=h.closest("li");var c=$("#pma_navigation .throbber").first().clone().css("visibility","visible");g.hide();c.insertBefore(g);var j=PMA_fastFilter.getSearchClause();var d=PMA_fastFilter.getSearchClause2($(this));var e={aPath:$(this).find("span.aPath").text(),vPath:$(this).find("span.vPath").text(),pos:$(this).find("span.pos").text(),pos2_name:$(this).find("span.pos2_name").text(),pos2_value:$(this).find("span.pos2_value").text(),searchClause:j,searchClause2:d};var a=$("#pma_navigation").find("a.navigation_url").attr("href");$.get(a,e,function(k){if(k.success===true){h.addClass("loaded");f.find("div.list_container").remove();f.append(k.message);g.removeClass("ic_b_plus").addClass("ic_b_minus");f.children("div.list_container").show("fast");if(f.find("ul > li").length==1){f.find("ul > li").find("a.expander.container").click()}}else{PMA_ajaxShowMessage(k.error,false)}g.show();c.remove()})}$(this).blur()});$("#pma_navigation_reload").live("click",function(a){a.preventDefault();PMA_reloadNavigation()});$("#pma_navigation_tree li.fast_filter span").live("click",PMA_fastFilter.events.clear);$("#pma_navigation_tree li.fast_filter input.searchClause").live("focus",PMA_fastFilter.events.focus).live("blur",PMA_fastFilter.events.blur).live("keyup",PMA_fastFilter.events.keyup);$("#pma_navigation_tree div.pageselector a.ajax").live("click",function(a){a.preventDefault();PMA_navigationTreePagination($(this))});$("#pma_navigation_tree.highlight li:not(.fast_filter)").live("mouseover",function(){if($("li:visible",this).length==0){$(this).addClass("activePointer")}});$("#pma_navigation_tree.highlight li:not(.fast_filter)").live("mouseout",function(){$(this).removeClass("activePointer")});$("#recentTable").live("change",function(){if(this.value!=""){var a=jQuery.parseJSON(this.value);var b=$(this).closest("form");b.find("input[name=db]").val(a.db);b.find("input[name=table]").val(a.table);b.submit()}});$("li.new_procedure a.ajax, li.new_function a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("routine");a.editorDialog(1,$(this))});$("li.new_trigger a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("trigger");a.editorDialog(1,$(this))});$("li.new_event a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("event");a.editorDialog(1,$(this))});$("li.procedure > a.ajax, li.function > a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("routine");a.editorDialog(0,$(this))});$("li.trigger > a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("trigger");a.editorDialog(0,$(this))});$("li.event > a.ajax").live("click",function(b){b.preventDefault();var a=new RTE.object("event");a.editorDialog(0,$(this))});$("li.procedure a.ajax img, li.function a.ajax img, li.trigger a.ajax img, li.event a.ajax img").live("click",function(b){b.preventDefault();var a=new RTE.object();a.exportDialog($(this).parent())});$("li.new_index a.ajax").live("click",function(b){b.preventDefault();var a=$(this).attr("href").substr($(this).attr("href").indexOf("?")+1)+"&ajax_request=true";var c=PMA_messages.strAddIndex;indexEditorDialog(a,c)});$("li.index a.ajax").live("click",function(b){b.preventDefault();var a=$(this).attr("href").substr($(this).attr("href").indexOf("?")+1)+"&ajax_request=true";var c=PMA_messages.strEditIndex;indexEditorDialog(a,c)});$("li.new_view a.ajax").live("click",function(a){a.preventDefault();PMA_createViewDialog($(this))})});function PMA_reloadNavigation(e){var b=$("#pma_navigation .throbber").first().css("visibility","visible");var d={reload:true,pos:$("#pma_navigation_tree").find("a.expander:first > span.pos").text()};var c=0;$("#pma_navigation_tree").find("a.expander:visible").each(function(){if($(this).find("img").is(".ic_b_minus")&&$(this).closest("li").find("div.list_container .ic_b_minus").length==0){d["n"+c+"_aPath"]=$(this).find("span.aPath").text();d["n"+c+"_vPath"]=$(this).find("span.vPath").text();var g=$(this).find("span.pos2_name").text();if(!g){g=$(this).parent().parent().find("span.pos2_name:last").text()}var f=$(this).find("span.pos2_value").text();if(!f){f=$(this).parent().parent().find("span.pos2_value:last").text()}d["n"+c+"_pos2_name"]=g;d["n"+c+"_pos2_value"]=f;d["n"+c+"_pos3_name"]=$(this).find("span.pos3_name").text();d["n"+c+"_pos3_value"]=$(this).find("span.pos3_value").text();c++}});var a=$("#pma_navigation").find("a.navigation_url").attr("href");$.post(a,d,function(f){b.css("visibility","hidden");if(f.success){$("#pma_navigation_tree").html(f.message).children("div").show();if(typeof e==="function"){e.call()}}else{PMA_ajaxShowMessage(f.error)}})}function PMA_navigationTreePagination(e){var d=PMA_ajaxShowMessage();var a=e.closest("div.pageselector").is(".dbselector");if(e[0].tagName=="A"){var b=e.attr("href");var g="ajax_request=true"}else{var b="navigation.php";var g=e.closest("form").serialize()+"&ajax_request=true"}var c=PMA_fastFilter.getSearchClause();if(c){g+="&searchClause="+encodeURIComponent(c)}if(a){g+="&full=true"}else{var f=PMA_fastFilter.getSearchClause2(e);if(f){g+="&searchClause2="+encodeURIComponent(f)}}$.post(b,g,function(h){PMA_ajaxRemoveMessage(d);if(h.success){if(a){var j=PMA_fastFilter.getSearchClause();$("#pma_navigation_tree").html(h.message).children("div").show();if(j){$("#pma_navigation_tree").find("li.fast_filter input.searchClause").val(j)}}else{var i=e.closest("div.list_container").parent();var j=PMA_fastFilter.getSearchClause2(e);e.closest("div.list_container").html($(h.message).children().show());if(j){i.find("li.fast_filter input.searchClause").val(j)}i.find("span.pos2_value:first").text(i.find("span.pos2_value:last").text());i.find("span.pos3_value:first").text(i.find("span.pos3_value:last").text())}}else{PMA_ajaxShowMessage(h.error)}})}var ResizeHandler=function(){this.active=false;this.panel_width=0;this.left=$("html").attr("dir")=="ltr"?"left":"right";this.setWidth=function(f){var e=$("#pma_navigation_resizer");var d=e.width();var c=$("#pma_navigation_collapser");$("#pma_navigation").width(f);$("body").css("margin-"+this.left,f+"px");$("#floating_menubar").css("margin-"+this.left,(f+d)+"px");e.css(this.left,f+"px");if(f===0){c.css(this.left,f+d).html(this.getSymbol(f)).prop("title",PMA_messages.strShowPanel)}else{c.css(this.left,f).html(this.getSymbol(f)).prop("title",PMA_messages.strHidePanel)}setTimeout(function(){$(window).trigger("resize")},4)};this.getPos=function(d){var e=d.pageX;var c=$(window).width();if(this.left!="left"){e=c-d.pageX}if(e<0){e=0}else{if(e+100>=c){e=c-100}else{this.panel_width=0}}return e};this.getSymbol=function(c){if(this.left=="left"){if(c==0){return"&rarr;"}else{return"&larr;"}}else{if(c==0){return"&larr;"}else{return"&rarr;"}}};this.mousedown=function(c){c.preventDefault();c.data.resize_handler.active=true;$("body").css("cursor","col-resize")};this.mouseup=function(c){if(c.data.resize_handler.active){c.data.resize_handler.active=false;$("body").css("cursor","");$.cookie("pma_navi_width",c.data.resize_handler.getPos(c));$("#topmenu").menuResizer("resize")}};this.mousemove=function(c){if(c.data&&c.data.resize_handler&&c.data.resize_handler.active){c.preventDefault();var d=c.data.resize_handler.getPos(c);c.data.resize_handler.setWidth(d)}};this.collapse=function(e){e.preventDefault();e.data.active=false;var d=e.data.resize_handler.panel_width;var c=$("#pma_navigation").width();if(c===0&&d===0){d=240}e.data.resize_handler.setWidth(d);e.data.resize_handler.panel_width=c};if($.cookie("pma_navi_width")){var b=Math.abs(parseInt($.cookie("pma_navi_width"),10)||0);this.setWidth(b);$("#topmenu").menuResizer("resize")}$("#pma_navigation_resizer").live("mousedown",{resize_handler:this},this.mousedown);$(document).bind("mouseup",{resize_handler:this},this.mouseup).bind("mousemove",{resize_handler:this},$.throttle(this.mousemove,4));var a=$("#pma_navigation_collapser");a.live("click",{resize_handler:this},this.collapse);a.html(this.getSymbol($("#pma_navigation").width()))};var PMA_fastFilter={filter:function(b,a){this.$this=b;this.searchClause=a;this.$clone=b.clone();this.swapped=false;this.xhr=null;this.timeout=null;var c=b.find("li.fast_filter input.searchClause");if(c.length!=0&&c.val()!=""&&c.val()!=c[0].defaultValue){this.request()}},getSearchClause:function(){var a="";var b=$("#pma_navigation_tree").find("li.fast_filter.db_fast_filter input.searchClause");if(b.length&&b.val()!=b[0].defaultValue){a=b.val()}return a},getSearchClause2:function(b){var a=b.closest("div.list_container");var d=$([]);while(1){if(a.find("li.fast_filter:not(.db_fast_filter) input.searchClause").length!=0){d=a.find("li.fast_filter:not(.db_fast_filter) input.searchClause");break}else{if(!a.is("div.list_container")){break}}a=a.parent().closest("div.list_container")}var c="";if(d.length!=0&&d.first().val()!=d[0].defaultValue){c=d.val()}return c},events:{focus:function(a){var b=$(this).closest("div.list_container");if(!b.data("fastFilter")){b.data("fastFilter",new PMA_fastFilter.filter(b,$(this).val()))}if($(this).val()==this.defaultValue){$(this).val("")}else{$(this).select()}},blur:function(a){if($(this).val()==""){$(this).val(this.defaultValue)}var b=$(this).closest("div.list_container");if($(this).val()==this.defaultValue&&b.data("fastFilter")){b.data("fastFilter").restore()}},keyup:function(b){var d=$(this).closest("div.list_container");var c="";if($(this).val()!=this.defaultValue&&$(this).val()!=""){d.find("div.pageselector").hide();c=$(this).val().toLowerCase()}d.find("li > a").not(".container").each(function(){if($(this).text().toLowerCase().indexOf(c)!=-1){$(this).parent().show().removeClass("hidden")}else{$(this).parent().hide().addClass("hidden")}});var a=function(e,f){e.children("li").children("a.container").each(function(){var g=$(this).parent().children("ul");if(g.children("li").children("a.container").length>0){a(g)}g.parent().show().removeClass("hidden");if(g.children().not(".hidden").length==0){g.parent().hide().addClass("hidden")}})};a(d,c);if($(this).val()!=this.defaultValue&&$(this).val()!=""){if(!d.data("fastFilter")){d.data("fastFilter",new PMA_fastFilter.filter(d,$(this).val()))}else{d.data("fastFilter").update($(this).val())}}else{if(d.data("fastFilter")){d.data("fastFilter").restore(true)}}},clear:function(b){b.stopPropagation();var a=$(this).closest("div.list_container").data("fastFilter");if(a){a.restore()}var c=$(this).prev()[0].defaultValue;$(this).prev().val(c).trigger("keyup")}}};PMA_fastFilter.filter.prototype.update=function(a){if(this.searchClause!=a){this.searchClause=a;this.$this.find(".moreResults").remove();this.request()}};PMA_fastFilter.filter.prototype.request=function(){var a=this;clearTimeout(a.timeout);if(a.$this.find("li.fast_filter").find("img.throbber").length==0){a.$this.find("li.fast_filter").append($('<div class="throbber"></div>').append($("#pma_navigation_content").find("img.throbber").clone().css("visibility","visible")))}a.timeout=setTimeout(function(){if(a.xhr){a.xhr.abort()}var b=$("#pma_navigation").find("a.navigation_url").attr("href");var c=a.$this.find("li:not(.hidden):not(.fast_filter):not(.navGroup)").not("[class^=new]").length;var d=a.$this.find("> ul > li > form.fast_filter").first().serialize()+"&results="+c;if(a.$this.find("> ul > li > form.fast_filter:first input[name=searchClause]").length==0){var e=$("#pma_navigation_tree").find("li.fast_filter.db_fast_filter input.searchClause");if(e.length&&e.val()!=e[0].defaultValue){d+="&searchClause="+encodeURIComponent(e.val())}}a.xhr=$.ajax({url:b,type:"post",dataType:"json",data:d,complete:function(h){var i=$.parseJSON(h.responseText);a.$this.find("li.fast_filter").find("div.throbber").remove();if(i&&i.results){var g=$("<li />",{"class":"moreResults"}).appendTo(a.$this.find("li.fast_filter"));var f=$("<a />",{href:"#"}).text(i.results).appendTo(g).click(function(j){j.preventDefault();a.swap.apply(a,[i.message])})}}})},250)};PMA_fastFilter.filter.prototype.swap=function(a){this.swapped=true;this.$this.html($(a).html()).children().show().end().find("li.fast_filter input.searchClause").val(this.searchClause);this.$this.data("fastFilter",this)};PMA_fastFilter.filter.prototype.restore=function(a){if(this.swapped){this.swapped=false;this.$this.html(this.$clone.html()).children().show();this.$this.data("fastFilter",this);if(a){this.$this.find("li.fast_filter input.searchClause").focus()}}this.searchClause="";this.$this.find(".moreResults").remove();this.$this.find("div.pageselector").show();this.$this.find("div.throbber").remove()};